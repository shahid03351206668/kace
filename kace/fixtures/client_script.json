[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Kace Settings",
  "enabled": 1,
  "modified": "2025-06-03 19:42:00.589782",
  "module": "KACE",
  "name": "Kace Settings",
  "script": "frappe.ui.form.on('Kace Settings', {\r\n\trefresh(frm) {\r\n\t\t// your code here\r\n\t},\r\n\tsend_notification(frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: \"kace.kace_notification.send_employee_checkin_notification\",\r\n\t\t\tfreeze: true,\r\n\t\t\tcallback(r) {\r\n\t\t\t\tfrappe.show_alert({\r\n\t\t\t\t\tmessage: __('Notification Sent'),\r\n\t\t\t\t\tindicator: 'green'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n})\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2025-04-17 19:36:35.428594",
  "module": "KACE",
  "name": "Employee Script",
  "script": "frappe.ui.form.on('Employee', {\n     onload(frm) {\n        set_face_verification_default(frm);\n    },\n\trefresh(frm) {\n\t\tcreate_custom_button(frm)\n\t}\n})\nfunction set_face_verification_default(frm) {\n    frappe.db.get_single_value('Kace Settings', 'default_face_verification').then(value => {\n        if (value) {\n            frm.set_value('face_verification', value);\n        }\n    });\n}\nfunction create_custom_button(frm){\n    frm.add_custom_button('Send Alert', ()=>{\n\t\tfrappe.call({\n\t\t    method:\"kace.kace_notification.send_notification\",\n\t\t    freeze: true,\n\t\t    args:{\"user_id\":frm.doc.user_id},\n\t\t    callback:function(res){\n\t\t        frappe.show_alert({\n                    message:__('Notification alert send successfully'),\n                    indicator:'green'\n                }, 5);\n\n\n\t\t    }\n\t\t})\n\t})\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Attendance Location",
  "enabled": 1,
  "modified": "2025-07-08 15:21:12.268038",
  "module": "KACE",
  "name": "Attendance Location",
  "script": "frappe.ui.form.on('Attendance Location', {\r\n    refresh(frm) {\r\n        console.log(\"map\")\r\n        console.log(frm.doc.map)\r\n        if (!frm.doc.map) {\r\n            const { latitude, longitude } = frm.doc;\r\n            const position = [parseFloat(latitude), parseFloat(longitude)];\r\n            L.marker(position).addTo(frm.get_field(\"map\").map);\r\n            frm.get_field(\"map\").map.setView(position, 15);\r\n        }\r\n    },\r\n\r\n    map(frm) {\r\n        const { map } = frm.doc;\r\n        try {\r\n            const coordinates = JSON.parse(map).features[0].geometry.coordinates;\r\n            const lat = coordinates[0];\r\n            const lng = coordinates[1];\r\n\r\n            frm.set_value(\"latitude\", lat);\r\n            frm.set_value(\"longitude\", lng);\r\n\r\n        } catch (error) {\r\n\r\n        }\r\n    },\r\n\r\n    get_employees: function (frm) {\r\n        let filters = {\r\n            \"employee\": frm.doc.employee || null,\r\n            \"branch\": frm.doc.branch || null,\r\n            \"designation\": frm.doc.designation || null,\r\n            \"department\": frm.doc.department || null\r\n        };\r\n\r\n        frappe.call({\r\n            method: 'kace.kace.doctype.attendance_location.attendance_location.get_employee_data',\r\n            freeze: true,\r\n            args: { \"filters\": filters },\r\n            callback: function (response) {\r\n                if (response?.message) {\r\n                    for (const row of response.message) {\r\n                        // console.log(frm.doc?.item?.find(i => i.employee == row.employee))\r\n                        if (!frm.doc?.item?.find(i => i.employee == row.employee)) {\r\n                            cur_frm.add_child(\"item\", row);\r\n                        }\r\n                    }\r\n                    frm.refresh_field(\"item\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n\r\nfunction set_map(frm) {\r\n    const { latitude, longitude } = frm.doc;\r\n\r\n    if (!latitude || !longitude) {\r\n        return;\r\n    }\r\n\r\n    frm.set_value(\"map\", `{\"type\":\"FeatureCollection\",\"features\":[{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Point\",\"coordinates\":[${parseFloat(latitude)},${parseFloat(longitude)}]}}]}`);\r\n    console.log(\"value updated\")\r\n}\r\n\r\nfrappe.ui.form.on('Attendance Location', {\r\n    refresh(frm) {\r\n    },\r\n\r\n    map(frm) {\r\n        const { map } = frm.doc;\r\n        try {\r\n            const coordinates = JSON.parse(map).features[0].geometry.coordinates;\r\n            const lat = coordinates[0];\r\n            const lng = coordinates[1];\r\n\r\n            frm.set_value(\"latitude\", lat);\r\n            frm.set_value(\"longitude\", lng);\r\n\r\n        } catch (error) {\r\n\r\n        }\r\n    },\r\n\r\n    get_employees: function (frm) {\r\n        let filters = {\r\n            \"employee\": frm.doc.employee || null,\r\n            \"branch\": frm.doc.branch || null,\r\n            \"designation\": frm.doc.designation || null,\r\n            \"department\": frm.doc.department || null\r\n        };\r\n\r\n        frappe.call({\r\n            method: 'kace.kace.doctype.attendance_location.attendance_location.get_employee_data',\r\n            freeze: true,\r\n            args: { \"filters\": filters },\r\n            callback: function (response) {\r\n                if (response?.message) {\r\n                    for (const row of response.message) {\r\n                        // console.log(frm.doc?.item?.find(i => i.employee == row.employee))\r\n                        if (!frm.doc?.item?.find(i => i.employee == row.employee)) {\r\n                            cur_frm.add_child(\"item\", row);\r\n                        }\r\n                    }\r\n                    frm.refresh_field(\"item\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Notification Schedule",
  "enabled": 1,
  "modified": "2025-06-03 19:41:50.729810",
  "module": "KACE",
  "name": "Notification Schedule",
  "script": "frappe.ui.form.on('Notification Schedule', {\r\n    refresh(frm) {\r\n        // your code here\r\n    },\r\n    get_employee: function (frm) {\r\n        let filters = {\r\n            \"employee\": frm.doc.employee || null,\r\n            \"branch\": frm.doc.branch || null,\r\n            \"designation\": frm.doc.designation || null,\r\n            \"department\": frm.doc.department || null\r\n        };\r\n\r\n        frappe.call({\r\n            method: 'kace.kace.doctype.attendance_location.attendance_location.get_employee_data',\r\n            freeze: true,\r\n            args: { \"filters\": filters },\r\n            callback: function (response) {\r\n                if (response?.message) {\r\n                    for (const row of response.message) {\r\n                        // console.log(frm.doc?.item?.find(i => i.employee == row.employee))\r\n                        if (!frm.doc?.employees?.find(i => i.employee == row.employee)) {\r\n                            frm.add_child(\"employees\", { \"employee\": row.employee });\r\n                        }\r\n                    }\r\n                    frm.refresh_field(\"employees\");\r\n                }\r\n            }\r\n        });\r\n\r\n    }\r\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Checkin",
  "enabled": 1,
  "modified": "2025-06-03 21:48:23.502125",
  "module": "KACE",
  "name": "Employee Checkin",
  "script": "\r\nfrappe.ui.form.on('Employee Checkin', {\r\n    refresh(frm) {\r\n        frm.set_df_property(\"custom_map_location\", \"options\", `<div style=\"width: 100%;\"><iframe width=\"100%\" height=\"600\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\"\r\n                    marginwidth=\"0\"\r\n                    src=\"https://maps.google.com/maps?width=100%25&amp;height=600&amp;hl=en&amp;q=${frm.doc.custom_latitude}, ${frm.doc.custom_longitude}&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed\"><a\r\n                        href=\"https://www.gps.ie/\">gps trackers</a></iframe></div>`)\r\n\r\n        // your code here\r\n    }\r\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Location Request",
  "enabled": 1,
  "modified": "2025-07-08 15:21:18.888022",
  "module": "KACE",
  "name": "Location Request",
  "script": "frappe.ui.form.on('Location Request', {\n\trefresh(frm) {\n\t    frm.set_df_property(\"map_html\", \"options\", `<div style=\"width: 100%;\"><iframe width=\"100%\" height=\"600\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\"\n                    marginwidth=\"0\"\n                    src=\"https://maps.google.com/maps?width=100%25&amp;height=600&amp;hl=en&amp;q=${frm.doc.latitude}, ${frm.doc.longitude}&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed\"><a\n                        href=\"https://www.gps.ie/\">gps trackers</a></iframe></div>`)\n\n\t\t// your code here\n\t}\n})",
  "view": "Form"
 }
]